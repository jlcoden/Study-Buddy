<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>WeatherApp</title>

    <style>
      .weather {
        color: white;
        background-color: #424242;
        width: 40%;
        border: 2px solid black;
        margin: 5px;
      }

      p {
        margin: 5px;
        padding: 0px;
      }

      #img {
        display: block;
        margin-left: auto;
        margin-right: auto;
        width: 40%;
      }
    </style>
  </head>

  <body>
    <!-- Retrieved data will be dumped here -->
    <div id="forecast-view"></div>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"
    ></script>

    <!-- Link to Moment.js should go here -->
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

    <script type="text/javascript">
      // This is our API key
      var APIKey = "&appid=8c24bcb54a1a145708ca7717f2851eb4";
      var lat = 47;
      var lon = 122;
      var weatherDays = [];
      //   https://api.openweathermap.org/data/2.5/forecast?lat=35&lon=139&appid=8c24bcb54a1a145708ca7717f2851eb4
      // Here we are building the URL we need to query the database
      var queryURL =
        "https://api.openweathermap.org/data/2.5/forecast/daily?lat=" +
        lat +
        "&lon=" +
        lon +
        "&cnt=14" +
        APIKey +
        "&units=imperial";

      // Here we run our AJAX call to the OpenWeatherMap API
      $.ajax({
        url: queryURL,
        method: "GET"
      }).then(function(results) {
        // Log the queryURL
        console.log(queryURL);
        // Log the resulting object
        // Transfer content to HTML
        $(".city").html("<h1>" + results.city.name + " Weather Details</h1>");
        processWeather(results.list);
        console.log(weatherDays);
      });

      function processWeather(daysData) {
        for (var i = 0; i < daysData.length; i++) {
          var weatherDiv = $("<div class='weather'>");

          var temp = daysData[i].temp.day;
          var forecast = daysData[i].weather[0].description;
          //    var humidity = days.Data[i].weather[0].list[i].humidity;
          var date = new Date(daysData[i].dt * 1000);
          var shortDate = moment(date).format("MM/DD/YYYY");
          var month = moment(date).format("MMMM");
          var day = moment(date).format("DD");
          console.log(month);
          console.log(day);
          console.log(shortDate);
          var weatherIcon =
            '<img src="https://openweathermap.org/img/w/' +
            daysData[i].weather[0].icon +
            '.png"/>';

          var pTemp = $("<p id ='pTemp'></div>").text(
            "Temperature (F): " + temp
          );
          var pText = $("<p id ='pText'></div>").text("Forecast: " + forecast);
          //  var pHumidity = $("<p id ='pHumidity'>").text(
          //    "Humidity: " + humidity
          //   );
          var pDate = $("<p id = 'pDate'></div>").text("Date: " + date);

          var pShortDate = $("<p id = 'pShortDate'></div>").text(
            "Date: " + shortDate
          );
          var imgWeatherIcon = $(
            "<div = 'weatherIcon'>" + weatherIcon + "</div>"
          );

          weatherDiv.append(pShortDate);
          weatherDiv.append(pTemp);
          weatherDiv.append(pText);
          // weatherDiv.append(pHumidity);
          //  weatherDiv.append(pDate);
          weatherDiv.append(imgWeatherIcon);

          $("#forecast-view").append(weatherDiv);

          weatherDays.push({
            temp: Math.round(daysData[i].temp.day),
            forecast: daysData[i].weather[0].description,
            date: new Date(daysData[i].dt * 1000)
          });
        }

        var day1 = weatherDays[0];
        var day2 = weatherDays[1];
        var dayAfterTomorrow = weatherDays[2];
      }
    </script>
  </body>
</html>
