<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCmhlYrcIaalp0JkPrA2_XqDOX-wL9WXdk&libraries=places"
      type="text/javascript"
    ></script>

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"
    ></script>
  </head>
  <body>
    <input
      id="searchTextField"
      type="text"
      size="50"
      placeholder="Enter a location"
      autocomplete="on"
      runat="server"
    />

    <div id="maps-link" class="maps-link"></div>
    <button type="button" id="submit">
      Confirm
    </button>

    <div class="maps-image"></div>

    <script>
      var lat;
      var lng;

      document.addEventListener("DOMContentLoaded", function() {
        function initialize() {
          var input = document.getElementById("searchTextField");
          var autocomplete = new google.maps.places.Autocomplete(input);
          google.maps.event.addListener(
            autocomplete,
            "place_changed",
            function() {
              var place = autocomplete.getPlace();
              // get lat
              lat = place.geometry.location.lat();
              // get lng
              lng = place.geometry.location.lng();

              console.log(lat);
              console.log(lng);
            }
          );
        }
        google.maps.event.addDomListener(window, "load", initialize);
      });

      $(document).ready(function() {
        $("#maps-link").keyup(function(event) {
          if (event.keyCode == 13) {
            $("#submit").click();
          }
        });

        $("#submit").click(function() {
          $("#submit").attr("disabled", "disabled");
          showTile(event);
        });
      });

      function showTile(event) {
        console.log("ShowTile");
        console.log(window.lat);
        console.log(window.lng);
        var img = $("<img/>", {
          id: "Myid",
          style: "cursor: pointer",
          src:
            "https://maps.googleapis.com/maps/api/staticmap?center=" +
            window.lat +
            "," +
            window.lng +
            "&zoom=17&size=600x600&format=png32&maptype=roadmap&markers=size:mid|color:red|" +
            window.lat +
            "," +
            window.lng +
            "&key=AIzaSyCmhlYrcIaalp0JkPrA2_XqDOX-wL9WXdk",
          alt: "MyAlt"
        });

        $(".maps-image").append(img);
        $(".maps-image").on("click", function() {
          mapsSelector();
        });
      }

      function mapsSelector() {
        if (
          /* if we're on iOS, open in Apple Maps */
          navigator.platform.indexOf("iPhone") != -1 ||
          navigator.platform.indexOf("iPod") != -1 ||
          navigator.platform.indexOf("iPad") != -1
        )
          window.open(
            "maps://maps.google.com/maps/dir/?daddr=" +
              window.lat +
              "," +
              window.lng +
              "&amp;ll="
          );
        /* else use Google */ else
          window.open(
            "https://maps.google.com/maps/dir/?daddr=" +
              window.lat +
              "," +
              window.lng +
              "&amp;ll="
          );
      }
    </script>
  </body>
</html>
