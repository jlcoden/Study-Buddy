<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Google Maps API</title>

    <!-- endpoint to Google places API-->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCmhlYrcIaalp0JkPrA2_XqDOX-wL9WXdk&libraries=places"
      type="text/javascript"
    ></script>

    <!-- Jquery libraries-->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"
    ></script>
  </head>
  <body>
    <!-- input field for search-->
    <input
      id="searchTextField"
      type="text"
      size="50"
      placeholder="Enter a location"
      autocomplete="on"
      runat="server"
    />

    <!--submit button-->
    <button type="button" id="submit">
      Confirm
    </button>

    <!--Div for populating Google Map Tile-->
    <div class="maps-image"></div>

    <!-- Javascript-->
    <script>
      //declaring lattitude and longitude variables
      var lat;
      var lng;

      //document event listener
      document.addEventListener("DOMContentLoaded", function() {
        //function to initalize map
        function initialize() {
          //grab input from text search input
          var input = document.getElementById("searchTextField");
          //use Google's autocomplete functionlity to search for places
          var autocomplete = new google.maps.places.Autocomplete(input);
          google.maps.event.addListener(
            autocomplete,
            "place_changed",
            function() {
              var place = autocomplete.getPlace();
              // get lat
              lat = place.geometry.location.lat();
              // get lng
              lng = place.geometry.location.lng();

              console.log(lat);
              console.log(lng);
            }
          );
        } //add listener
        google.maps.event.addDomListener(window, "load", initialize);
      });

      //on document
      $(document).ready(function() {
        //check if enter key is pressed
        $("#searchTextField").keyup(function(event) {
          if (event.keyCode == 13) {
            //if pressed click submit button
            $("#submit").click();
          }
        });
        //when submit button is clicked
        $("#submit").click(function() {
          //disable so that only one map can be populated in a session
          $("#submit").attr("disabled", "disabled");
          //show tile of static map
          showTile(event);
        });
      });

      //show tile of map image
      function showTile(event) {
        //console log for debugging
        console.log("ShowTile");
        console.log(window.lat);
        console.log(window.lng);
        //dynamically create an image div to hold the populated Map tile
        var img = $("<img/>", {
          id: "Myid",
          style: "cursor: pointer",
          //Google API endpoint for populating static map
          src:
            "https://maps.googleapis.com/maps/api/staticmap?center=" +
            window.lat +
            "," +
            window.lng +
            "&zoom=17&size=600x600&format=png32&maptype=roadmap&markers=size:mid|color:red|" +
            window.lat +
            "," +
            window.lng +
            "&key=AIzaSyCmhlYrcIaalp0JkPrA2_XqDOX-wL9WXdk",
          alt: "MyAlt"
        });

        //append the populated static mamp to the image div container
        $(".maps-image").append(img);
        //add an onclick function so that when the tile is clicked it calls the mapsSelector function
        $(".maps-image").on("click", function() {
          mapsSelector();
        });
      }

      //mapSelector function checks if the map is being loading on ios or windows
      function mapsSelector() {
        if (
          /* if we're on iOS, open in Apple Maps */
          navigator.platform.indexOf("iPhone") != -1 ||
          navigator.platform.indexOf("iPod") != -1 ||
          navigator.platform.indexOf("iPad") != -1
        )
          window.open(
            "maps://maps.google.com/maps/dir/?daddr=" +
              window.lat +
              "," +
              window.lng +
              "&amp;ll="
          );
        /* else use Google */ else
          window.open(
            "https://maps.google.com/maps/dir/?daddr=" +
              window.lat +
              "," +
              window.lng +
              "&amp;ll="
          );
        //map is then loaded and user can search for directions
      }
    </script>
  </body>
</html>
